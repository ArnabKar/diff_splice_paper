setwd("~/Documents/Projects/DiffTranscriptUsage/analysis/simulations/Rcode")
astalavista.file <- "../human/reference_files/Homo_sapiens.GRCh37.71.protein_coding_sorted.gtf_astalavista.gtf"
final_summary <- "../human/non_null_simulation/3_truth/simulation_details.txt"
final_summary <- read.delim(final_summary, header = TRUE, as.is = TRUE)
library(GenomicRanges)
library(GenomicFeatures)
library(Hmisc)
library(dplyr)
library(rtracklayer)
gene_table <- final_summary %>% group_by(gene_id) %>%
summarise(ds_status = unique(gene_status),
TPM = sum(TPM),
nbr_isoforms = unique(nbr_isoforms),
diff_IsoPct = unique(diff_IsoPct))
gene_table$TPM_2 = cut2(gene_table$TPM, g = 2)
gene_table$TPM_5 = cut2(gene_table$TPM, g = 5)
gene_table$TPM_10 = cut2(gene_table$TPM, g = 10)
gene_table$nbr_isoforms_2 = cut2(gene_table$nbr_isoforms, g = 2)
gene_table$nbr_isoforms_5 = cut2(gene_table$nbr_isoforms, g = 5)
gene_table$nbr_isoforms_10 = cut2(gene_table$nbr_isoforms, g = 10)
gene_table$diff_IsoPct_2 = cut2(gene_table$diff_IsoPct, g = 2)
gene_table$diff_IsoPct_5 = cut2(gene_table$diff_IsoPct, g = 5)
gene_table$diff_IsoPct_10 = cut2(gene_table$diff_IsoPct, g = 10)
astalavista <- read.delim(astalavista.file, header = FALSE, as.is = TRUE)
av <- t(sapply(astalavista[, 9], function(w) {
tmp <- unlist(strsplit(w, ";"))
a <- gsub(" ", "", gsub("structure ", "", tmp[grep("structure", tmp)]))
b <- gsub("transcript_id ", "", tmp[grep("transcript_id", tmp)])
b1 <- paste(sort(unlist(strsplit(b, ","))), collapse = ";")
c(a, b1)
}))
rownames(av) <- NULL
colnames(av) <- c("as_type", "transcripts")
av <- as.data.frame(av, stringsAsFactors = FALSE)
head(av)
head(astalavista)
length(av[, 2])
length(grep("/", av[, 2]))
av1 <- av[-grep("/", av[, 2]), ]
av2 <- av[grep("/", av[, 2]), ]
?grep
myfun = function(mystr) {
mm = lapply(strsplit(mystr, ";"), strsplit, split = "/")
mm2 = expand.grid(mm[[1]][[1]], mm[[1]][[2]], stringsAsFactors = FALSE)
sapply(1:nrow(mm2), function(i) paste(sort(mm2[i, ]), collapse = ":"))
}
tmp_trs <- lapply(av2[, 2], myfun)
names(tmp_trs) <- av2[, 1]
tmp_trs <- stack(tmp_trs)
colnames(tmp_trs) <- c("transcripts", "as_type1")
tmp_trs <- tmp_trs %>% group_by(transcripts) %>%
summarise(as_type = paste(as_type1, collapse = ":"))
head(tmp_trs)
tail(tmp_trs)
head(av1)
tmp_trs <- tmp_trs[, c("as_type", "transcripts")]
head(tmp_trs)
av <- rbind(av1, tmp_trs)
dim(av)
head(av)
tail(av)
ds_transcripts <- subset(final_summary, transcript_status == 1) %>%
group_by(gene_id) %>%
summarise(transcripts = paste(sort(transcript_id), collapse = ";"))
ds_transcripts$as_type <- av$as_type[match(ds_transcripts$transcripts, av$transcripts)]
head(ds_transcripts)
av$transcripts <- gsub(":", ";", av$transcripts)
ds_transcripts$as_type <- av$as_type[match(ds_transcripts$transcripts, av$transcripts)]
head(ds_transcripts)
sum(is.na(ds_transcripts$as_type))
g <- grep("ENST00000233156", astalavista[, 9])
g
g2 <- grep("ENST00000426055", astalavista[, 9])
g2
intersect(g,g2)
astalavista[intersect(g,g2),]
head(av2)
g <- grep("ENST00000233156", av2[, 2])
g2 <- grep("ENST00000426055", av2[, 2])
g
g2
av2[intersect(g,g2),]
mytmp <- av2[intersect(g,g2),]
lapply(mytmp[, 2], myfun)
rm(list=ls())
astalavista <- read.delim("../human/reference_files/Homo_sapiens.GRCh37.71.protein_coding_sorted.gtf_astalavista.gtf")
final_summary <- read.delim("../human/non_null_simulation/3_truth/simulation_details.txt", header = TRUE, as.is = TRUE)
gene_table <- final_summary %>% group_by(gene_id) %>%
summarise(ds_status = unique(gene_status),
TPM = sum(TPM),
nbr_isoforms = unique(nbr_isoforms),
diff_IsoPct = unique(diff_IsoPct))
gene_table$TPM_2 = cut2(gene_table$TPM, g = 2)
gene_table$TPM_5 = cut2(gene_table$TPM, g = 5)
gene_table$TPM_10 = cut2(gene_table$TPM, g = 10)
gene_table$nbr_isoforms_2 = cut2(gene_table$nbr_isoforms, g = 2)
gene_table$nbr_isoforms_5 = cut2(gene_table$nbr_isoforms, g = 5)
gene_table$nbr_isoforms_10 = cut2(gene_table$nbr_isoforms, g = 10)
gene_table$diff_IsoPct_2 = cut2(gene_table$diff_IsoPct, g = 2)
gene_table$diff_IsoPct_5 = cut2(gene_table$diff_IsoPct, g = 5)
gene_table$diff_IsoPct_10 = cut2(gene_table$diff_IsoPct, g = 10)
astalavista <- read.delim("../human/reference_files/Homo_sapiens.GRCh37.71.protein_coding_sorted.gtf_astalavista.gtf", header = FALSE, as.is = TRUE)
av <- t(sapply(astalavista[, 9], function(w) {
tmp <- unlist(strsplit(w, ";"))
a <- gsub(" ", "", gsub("structure ", "", tmp[grep("structure", tmp)]))
b <- gsub("transcript_id ", "", tmp[grep("transcript_id", tmp)])
b1 <- paste(sort(unlist(strsplit(b, ","))), collapse = ";")
c(a, b1)
}))
rownames(av) <- NULL
colnames(av) <- c("as_type", "transcripts")
av <- as.data.frame(av, stringsAsFactors = FALSE)
av1 <- av[-grep("/", av[, 2]), ]
av2 <- av[grep("/", av[, 2]), ]
myfun = function(mystr) {
mm = lapply(strsplit(mystr, ";"), strsplit, split = "/")
mm2 = expand.grid(mm[[1]][[1]], mm[[1]][[2]], stringsAsFactors = FALSE)
sapply(1:nrow(mm2), function(i) paste(sort(mm2[i, ]), collapse = ";"))
}
tmp_trs <- lapply(av2[, 2], myfun)
names(tmp_trs) <- av2[, 1]
tmp_trs <- stack(tmp_trs)
colnames(tmp_trs) <- c("transcripts", "as_type1")
tmp_trs <- tmp_trs %>% group_by(transcripts) %>%
summarise(as_type = paste(as_type1, collapse = ":"))
tmp_trs <- tmp_trs[, c("as_type", "transcripts")]
av <- rbind(av1, tmp_trs)
ds_transcripts <- subset(final_summary, transcript_status == 1) %>%
group_by(gene_id) %>%
summarise(transcripts = paste(sort(transcript_id), collapse = ";"))
ds_transcripts$as_type <- av$as_type[match(ds_transcripts$transcripts, av$transcripts)]
head(ds_transcripts)
sum(is.na(ds_transcripts[,2]))
gene_table <- merge(gene_table, ds_transcripts[, c("gene_id", "as_type")],
by.x = "gene_id", by.y = "gene_id", all = TRUE)
head(gene_table)
table(gene_table$as_type)->tbl1
tbl1 <- sort(tbl1, decreasing = TRUE)
head(tbl1)
length(grep(":", names(tbl1)))
length(names(tbl1))
head(tbl1,n=20)
sum(tbl1)
m <- gene_table[gene_table$ds_status==1,]
dim(m)
head(m)
m$as_type
sum(is.na(m$as_type))
head(ds_transcripts)
m[988,]
ds_transcripts[ds_transcripts$gene_id == "ENSG00000232637",]
sum(is.na(ds_transcripts$as_type))
sum(is.na(ds_transcripts[,2]))
head(ds_transcripts[,2])
head(ds_transcripts)
